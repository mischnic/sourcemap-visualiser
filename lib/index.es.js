import e from"color";import n from"nice-color-palettes/1000";import a from"classnames";import t from"path";import{decode as l}from"sourcemap-codec";import r from"preact/compat";function o(e){let{sources:n,selectedSource:l,onSelect:o}=e;return r.createElement("div",{className:"h-full bg-gray-800 overflow-y-auto"},r.createElement("div",{className:"font-medium text-white p-2 bg-gray-600"},"Sources"),r.createElement("div",{className:"overflow-y-auto"},n.map((e,n)=>{let i=t.basename(t.dirname(e.name))+"/"+t.basename(e.name);return r.createElement("div",{className:a("whitespace-no-wrap text-white px-2 py-1 hover:bg-gray-500 cursor-pointer",{"bg-gray-700":l===n}),onClick:()=>{o(n)},key:n},i)})))}function i(e){let{mappings:n,hoveredMapping:t,onHoverMapping:l,selectedMapping:o,onSelectMapping:i}=e;return r.createElement("div",{className:"h-full bg-gray-100 overflow-y-auto"},r.createElement("div",{className:"font-medium text-gray-700 p-2"},"Mappings"),r.createElement("div",null,n.map((e,n)=>r.createElement("div",{className:a("px-2 font-medium text-gray-700 whitespace-no-wrap cursor-pointer",{underline:t===n,"bg-blue-200":o===n}),key:n,onMouseEnter:()=>l(n),onMouseLeave:()=>l(-1),onClick:()=>i(n)},r.createElement("span",null,e.originalLine,":",e.originalColumn),r.createElement("span",{className:"mx-1"},"-"),r.createElement("span",null,e.generatedLine,":",e.generatedColumn),e.name&&r.createElement("span",{className:"font-normal text-gray-600 ml-2"},"(",e.name,")")))))}function m(t){let{source:l,mappings:o,hoveredMapping:i,onHoverMapping:m,selectedMapping:c,onSelectMapping:s,generated:p}=t,u=r.useMemo(()=>{let e=[[]],n=0,a={value:"",mapping:null,mappingIndex:-1},t=0;for(let r of l.content){let l=e.length-1;if("\n"===r){a.value&&(e[l].push(a),a={value:"",mapping:null,mappingIndex:-1}),e.push([]),n=0;continue}let i=o[t];for(i.originalLine===l&&i.originalColumn===n&&(a.value&&e[l].push(a),a={value:"",mapping:i,mappingIndex:t});t<o.length-1&&(i.originalLine<l||i.originalLine===l&&i.originalColumn<n||i.originalLine===l&&i.originalColumn===n);)t++,i=o[t];a.value+=r,n++}return e},[l.name]),g=r.useMemo(()=>{if(c<0)return null;let e=o[c],n=o[c+1];n&&n.generatedLine!==e.generatedLine&&(n=null);let a=["","",""],t=p.split("\n"),l=0;for(let r of t[e.generatedLine])l<e.generatedColumn?a[0]+=r:n&&l>n.generatedColumn?a[2]+=r:a[1]+=r,l++;return{line:e.originalLine,parts:[a[0].slice(-20),a[1],a[2].slice(0,20)]}},[c]),d=l.content.split("\n").length.toString(10).length+1,f=0;return r.createElement("div",{className:"w-full h-full flex flex-col font-mono text-sm"},u.map((t,l)=>r.createElement(r.Fragment,{key:"line-".concat(l)},r.createElement("div",{className:"flex flex-row"},r.createElement("div",{className:"text-right px-2 bg-gray-200",style:{width:"".concat(d,"rem")}},l),r.createElement("div",{className:"px-4 whitespace-pre"},t.map((t,o)=>{let p={};return t.mapping&&(p.backgroundColor=n[f%5e3][f%5],p.color=(e=>{if(0===e.indexOf("#")&&(e=e.slice(1)),3===e.length&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]),6!==e.length)throw new Error("Invalid HEX color.");return.299*parseInt(e.slice(0,2),16)+.587*parseInt(e.slice(2,4),16)+.114*parseInt(e.slice(4,6),16)>186?"#000000":"#FFFFFF"})(p.backgroundColor),t.mappingIndex>-1&&(c===t.mappingIndex?(p.backgroundColor="#000000",p.color="#ffffff"):i===t.mappingIndex&&(p.backgroundColor=e(p.backgroundColor).darken(.25))),f++),r.createElement("span",{key:"line-".concat(l,"-mapping-").concat(o),className:a("rounded",{"cursor-pointer":!!t.mapping,"text-gray-600":!t.mapping}),style:p,onMouseEnter:()=>{t.mappingIndex>-1&&m(t.mappingIndex)},onMouseLeave:()=>m(-1),onClick:()=>{t.mappingIndex>-1&&s(t.mappingIndex)}},t.value)}))),g&&g.line===l&&r.createElement("div",{className:"p-2"},r.createElement("span",{className:"text-gray-500"},g.parts[0]),r.createElement("span",{className:"bg-black text-white"},g.parts[1]||"[NOT FOUND]"),r.createElement("span",{className:"text-gray-500"},g.parts[2])))),r.createElement("div",{className:"flex flex-row h-full"},r.createElement("div",{className:"flex px-2 bg-gray-200",style:{width:"".concat(d,"rem")}}),r.createElement("div",null)))}function c(e){let{sourcemap:n}=e,[a,t]=r.useState(0),[c,s]=r.useState(-1),[p,u]=r.useState(-1),g=r.useMemo(()=>function(e,n){let a=l(e),t=0,r=[];for(let e of a){for(let a of e){let e=a.length>1,l=a.length>4;r.push({generatedLine:t,generatedColumn:a[0],originalLine:e?a[2]:-1,originalColumn:e?a[3]:-1,sourceIndex:e?a[1]:-1,name:l?n[a[4]]:null})}t++}return r}(n.mappings,n.names),[n.mappings]),d=r.useMemo(()=>g.filter(e=>e.sourceIndex===a).sort((e,n)=>(null!=e.originalLine?1e4*e.originalLine+e.originalColumn:Number.MAX_VALUE)-(null!=n.originalLine?1e4*n.originalLine+n.originalColumn:Number.MAX_VALUE)),[a]);let f=n.sources[a];return r.createElement("div",{className:"h-full min-h-0 flex"},r.createElement("div",{className:"w-1/6"},r.createElement(o,{selectedSource:a,onSelect:e=>{u(-1),s(-1),t(e)},sources:n.sources})),r.createElement("div",{className:"w-4/6 overflow-y-auto"},f.content?r.createElement(m,{source:f,mappings:d,hoveredMapping:c,onHoverMapping:s,selectedMapping:p,onSelectMapping:u,generated:n.content}):r.createElement("div",{className:"p-2"},"No source content found for ",f.name)),r.createElement("div",{className:"w-1/6"},r.createElement(i,{mappings:d,hoveredMapping:c,onHoverMapping:s,selectedMapping:p,onSelectMapping:u})))}export default function s({sourcemapContent:e}){let[n,a]=r.useState(0);if(e.length>0){let t=e[n];return r.createElement("div",{id:"sourcemap-visualizer",className:"font-sans leading-normal h-full flex flex-col"},r.createElement("div",{className:"bg-gray-700 p-2 flex"},r.createElement("div",{className:"text-white mr-4"},"Select Bundle"),r.createElement("select",{className:"border-none",onChange:e=>{a(parseInt(e.target.value,10))}},e.map((e,n)=>r.createElement("option",{value:n,key:e.name},e.name)))),r.createElement(c,{sourcemap:t}))}}
//# sourceMappingURL=index.es.js.map
